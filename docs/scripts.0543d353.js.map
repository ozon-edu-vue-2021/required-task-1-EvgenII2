{"version":3,"sources":["scripts/index.js"],"names":["loaderTimeout","buttonLoadPictures","document","querySelector","templateImageCard","templateImagePopup","container","popup","popupContainer","popupClose","loader","MAX_PAGE_IAMGES","initialState","disabled","getPictures","page","limit","showLoader","fetch","then","response","json","result","renderPictures","getPictureInfo","id","renderPopupPicture","style","visibility","hideLoader","setTimeout","cropImage","src","size","split","splice","domain","key","width","height","newWidth","Math","floor","newHeight","list","length","Error","fragment","createDocumentFragment","forEach","element","clone","content","cloneNode","link","href","url","dataset","image","download_url","alt","author","classList","add","appendChild","picture","img","textContent","innerHTML","togglePopup","toggle","actionHandler","evt","preventDefault","nextPage","Number","currentTarget","console","warn","imageHandler","target","closest","addEventListener"],"mappings":";AAAA,aA+LY,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,6IAAA,SAAA,EAAA,EAAA,GAAA,GAAA,EAAA,CAAA,GAAA,iBAAA,EAAA,OAAA,EAAA,EAAA,GAAA,IAAA,EAAA,OAAA,UAAA,SAAA,KAAA,GAAA,MAAA,GAAA,GAAA,MAAA,WAAA,GAAA,EAAA,cAAA,EAAA,EAAA,YAAA,MAAA,QAAA,GAAA,QAAA,EAAA,MAAA,KAAA,GAAA,cAAA,GAAA,2CAAA,KAAA,GAAA,EAAA,EAAA,QAAA,GAAA,SAAA,EAAA,EAAA,IAAA,MAAA,GAAA,EAAA,EAAA,UAAA,EAAA,EAAA,QAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,GAAA,EAAA,EAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,EAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,MAAA,EAAA,KAAA,oBAAA,QAAA,EAAA,OAAA,WAAA,EAAA,cAAA,GAAA,MAAA,EAAA,CAAA,IAAA,EAAA,EAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,IAAA,IAAA,EAAA,EAAA,KAAA,KAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,GAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EA7LZ,IAWIA,EAXEC,EAAqBC,SAASC,cAAc,WAC5CC,EAAoBF,SAASC,cAAc,UAC3CE,EAAqBH,SAASC,cAAc,gBAC5CG,EAAYJ,SAASC,cAAc,WAEnCI,EAAQL,SAASC,cAAc,UAC/BK,EAAiBN,SAASC,cAAc,mBACxCM,EAAaP,SAASC,cAAc,kBACpCO,EAASR,SAASC,cAAc,WAEhCQ,EAAkB,GAOlBC,EAAe,WACnBX,EAAmBY,UAAW,EAC9BC,KASIA,EAAc,WAASC,IAAAA,EAAO,UAAA,OAAA,QAAA,IAAA,UAAA,GAAA,UAAA,GAAA,EAAGC,EAAQ,UAAA,OAAA,QAAA,IAAA,UAAA,GAAA,UAAA,GAAA,GAC7CC,IACAC,MAA4CH,sCAAAA,OAAAA,EAAcC,WAAAA,OAAAA,IACvDG,KAAK,SAASC,GACNA,OAAAA,EAASC,SAEjBF,KAAK,SAASG,GACbC,EAAeD,MASfE,EAAiB,WAASC,IAAAA,EAAK,UAAA,OAAA,QAAA,IAAA,UAAA,GAAA,UAAA,GAAA,EACnCR,IACAC,MAAkCO,4BAAAA,OAAAA,EAAlC,UACGN,KAAK,SAASC,GACNA,OAAAA,EAASC,SAEjBF,KAAK,SAASG,GACbI,EAAmBJ,MAQnBL,EAAa,WACjBP,EAAOiB,MAAMC,WAAa,WAOtBC,EAAa,WACjB7B,EAAgB8B,WAAW,WACzBpB,EAAOiB,MAAMC,WAAa,UACzB,MAUCG,EAAY,SAASC,GAAKC,IAAAA,EAAO,UAAA,OAAA,QAAA,IAAA,UAAA,GAAA,UAAA,GAAA,EACrC,EAAA,EAAyCD,EAAIE,MAAM,KAAKC,OAAO,GAA/D,GAAOC,EAAP,EAAA,GAAeC,EAAf,EAAA,GAAoBZ,EAApB,EAAA,GAAwBa,EAAxB,EAAA,GAA+BC,EAA/B,EAAA,GACMC,EAAWC,KAAKC,OAAOJ,EAAQL,GAC/BU,EAAYF,KAAKC,OAAOH,EAASN,GAErBG,MAAAA,WAAAA,OAAAA,EAAUC,KAAAA,OAAAA,EAAOZ,KAAAA,OAAAA,EAAMe,KAAAA,OAAAA,EAAYG,KAAAA,OAAAA,IAQjDpB,EAAiB,SAASqB,GAC1B,IAACA,EAAKC,OACFC,MAAAA,MAAgDF,0CAAAA,OAAAA,EAAKC,SAGvDE,IAAAA,EAAW7C,SAAS8C,yBAE1BJ,EAAKK,QAAQ,SAASC,GACdC,IAAAA,EAAQ/C,EAAkBgD,QAAQC,WAAU,GAC5CC,EAAOH,EAAMhD,cAAc,KAEjCmD,EAAKC,KAAOL,EAAQM,IACpBF,EAAKG,QAAQhC,GAAKyB,EAAQzB,GAEpBiC,IAAAA,EAAQP,EAAMhD,cAAc,OAClCuD,EAAM1B,IAAMD,EAAUmB,EAAQS,aAAc,GAC5CD,EAAME,IAAMV,EAAQW,OACpBH,EAAMI,UAAUC,IAAI,WACpBhB,EAASiB,YAAYb,KAGvB7C,EAAU0D,YAAYjB,GACtBlB,KAQIH,EAAqB,SAASuC,GAC5Bd,IAAAA,EAAQ9C,EAAmB+C,QAAQC,WAAU,GAC7Ca,EAAMf,EAAMhD,cAAc,OAC1BmD,EAAOH,EAAMhD,cAAc,KAC3B0D,EAASV,EAAMhD,cAAc,WAEnC+D,EAAIlC,IAAMD,EAAUkC,EAAQN,aAAc,GAC1CO,EAAIN,IAAMK,EAAQJ,OAClBA,EAAOM,YAAcF,EAAQJ,OAC7BK,EAAI5B,MAAQ2B,EAAQ3B,MAAQ,GAC5BgB,EAAKC,KAAOU,EAAQN,aAEpBnD,EAAe4D,UAAY,GAC3B5D,EAAewD,YAAYb,GAC3BtB,IACAwC,KAMIA,EAAc,WAClB9D,EAAMuD,UAAUQ,OAAO,SAWnBC,EAAgB,SAASC,GAC7BA,EAAIC,iBAEEC,IAAAA,EAAWC,OAAOH,EAAII,cAAcnB,QAAQ1C,MAClDyD,EAAII,cAAcnB,QAAQ1C,KAAO2D,EAAW,EAExCA,EAAW/D,GACbkE,QAAQC,KAC8CnE,oDAAAA,OAAAA,IAEtD6D,EAAII,cAAc/D,UAAW,GAE7BC,EAAY4D,IAUVK,EAAe,SAASP,GAC5BA,EAAIC,iBACAD,EAAIQ,OAAOC,QAAQ,MACrBzD,EAAegD,EAAIQ,OAAOC,QAAQ,KAAKxB,QAAQhC,KAInDxB,EAAmBiF,iBAAiB,QAASX,GAC7CjE,EAAU4E,iBAAiB,QAASH,GACpCtE,EAAWyE,iBAAiB,QAASb,GAErCzD","file":"scripts.0543d353.js","sourceRoot":"..\\src","sourcesContent":["\"use strict\";\r\n\r\nconst buttonLoadPictures = document.querySelector(\".button\");\r\nconst templateImageCard = document.querySelector(\"#image\");\r\nconst templateImagePopup = document.querySelector(\"#popup-image\");\r\nconst container = document.querySelector(\".images\");\r\n\r\nconst popup = document.querySelector(\".popup\");\r\nconst popupContainer = document.querySelector(\".popup .content\");\r\nconst popupClose = document.querySelector(\".popup .action\");\r\nconst loader = document.querySelector(\".loader\");\r\n\r\nconst MAX_PAGE_IAMGES = 34;\r\nlet loaderTimeout;\r\n\r\n/**\r\n * Функция задаёт первоначальное состояние страницы.\r\n * Отправляется первый запрос за картинками, юез параметров т.к. с дефолтными настройками.\r\n */\r\nconst initialState = function() {\r\n  buttonLoadPictures.disabled = false;\r\n  getPictures();\r\n};\r\n\r\n/**\r\n * Функция запрашивает картинки для галереи\r\n * и вызывает ф-цию отрисовки полученных картинок\r\n * @param {number} page\r\n * @param {number} limit\r\n */\r\nconst getPictures = function(page = 1, limit = 10) {\r\n  showLoader();\r\n  fetch(`https://picsum.photos/v2/list?page=${page};limit=${limit}`)\r\n    .then(function(response) {\r\n      return response.json();\r\n    })\r\n    .then(function(result) {\r\n      renderPictures(result);\r\n    });\r\n};\r\n\r\n/**\r\n * Функция запрашивает информацию о конкретной картинке по её id\r\n * и вызывает ф-цию для отрисовки картинки в попапе\r\n * @param {number} id\r\n */\r\nconst getPictureInfo = function(id = 0) {\r\n  showLoader();\r\n  fetch(`https://picsum.photos/id/${id}/info`)\r\n    .then(function(response) {\r\n      return response.json();\r\n    })\r\n    .then(function(result) {\r\n      renderPopupPicture(result);\r\n    });\r\n};\r\n\r\n/**\r\n * Функция показывает индикатор загрузки.\r\n * Меняет ситили, ничего не возвращает.\r\n */\r\nconst showLoader = function() {\r\n  loader.style.visibility = \"visible\";\r\n};\r\n\r\n/**\r\n * Функция скрывает индикатор загрузки.\r\n * Удаляет таймаут индикатора, ничего не возвращает.\r\n */\r\nconst hideLoader = function() {\r\n  loaderTimeout = setTimeout(function() {\r\n    loader.style.visibility = \"hidden\";\r\n  }, 700);\r\n};\r\n\r\n/**\r\n * Функция пропорционально делит размер картинки,\r\n * чтобы в превью не загружать слишком большие картинки,\r\n * которые возвращает сервис\r\n * @param {string} src\r\n * @param {number} size\r\n */\r\nconst cropImage = function(src, size = 2) {\r\n  const [domain, key, id, width, height] = src.split(\"/\").splice(2);\r\n  const newWidth = Math.floor(+width / size);\r\n  const newHeight = Math.floor(+height / size);\r\n\r\n  return `https://${domain}/${key}/${id}/${newWidth}/${newHeight}`;\r\n};\r\n\r\n/**\r\n * Функция копирует шаблон для каждой картинки,\r\n * заполняет его и встраивает в разметку\r\n * @param {array} list\r\n */\r\nconst renderPictures = function(list) {\r\n  if (!list.length) {\r\n    throw Error(`Pictures not defined. The list length: ${list.length}`);\r\n  }\r\n\r\n  const fragment = document.createDocumentFragment();\r\n\r\n  list.forEach(function(element) {\r\n    const clone = templateImageCard.content.cloneNode(true);\r\n    const link = clone.querySelector(\"a\");\r\n\r\n    link.href = element.url;\r\n    link.dataset.id = element.id;\r\n\r\n    const image = clone.querySelector(\"img\");\r\n    image.src = cropImage(element.download_url, 5);\r\n    image.alt = element.author;\r\n    image.classList.add(\"preview\");\r\n    fragment.appendChild(clone);\r\n  });\r\n\r\n  container.appendChild(fragment);\r\n  hideLoader();\r\n};\r\n\r\n/**\r\n * Функция копирует шаблон для картинки в попапе,\r\n * заполняет его и встраивает в попап\r\n * @param {object} picture\r\n */\r\nconst renderPopupPicture = function(picture) {\r\n  const clone = templateImagePopup.content.cloneNode(true);\r\n  const img = clone.querySelector(\"img\");\r\n  const link = clone.querySelector(\"a\");\r\n  const author = clone.querySelector(\".author\");\r\n\r\n  img.src = cropImage(picture.download_url, 2);\r\n  img.alt = picture.author;\r\n  author.textContent = picture.author;\r\n  img.width = picture.width / 10;\r\n  link.href = picture.download_url;\r\n\r\n  popupContainer.innerHTML = \"\";\r\n  popupContainer.appendChild(clone);\r\n  hideLoader();\r\n  togglePopup();\r\n};\r\n\r\n/**\r\n * Функция переклбчает класс открытия на попапе\r\n */\r\nconst togglePopup = function() {\r\n  popup.classList.toggle(\"open\");\r\n};\r\n\r\n/**\r\n * @type {object} MouseEvent\r\n */\r\n\r\n/**\r\n * Обработчик кнопки подгрузки картинок\r\n * @param {MouseEvent} evt\r\n */\r\nconst actionHandler = function(evt) {\r\n  evt.preventDefault();\r\n\r\n  const nextPage = Number(evt.currentTarget.dataset.page);\r\n  evt.currentTarget.dataset.page = nextPage + 1;\r\n\r\n  if (nextPage > MAX_PAGE_IAMGES) {\r\n    console.warn(\r\n      `WARN: You are trying to call a page that exceeds ${MAX_PAGE_IAMGES}`\r\n    );\r\n    evt.currentTarget.disabled = true;\r\n  } else {\r\n    getPictures(nextPage);\r\n  }\r\n};\r\n\r\n/**\r\n * Обработчик события click по картинкам.\r\n * Запрашивает данные по картинке, на которую кликнули,\r\n * для открытия попапа с ней\r\n * @param {MouseEvent} evt\r\n */\r\nconst imageHandler = function(evt) {\r\n  evt.preventDefault();\r\n  if (evt.target.closest(\"a\")) {\r\n    getPictureInfo(evt.target.closest(\"a\").dataset.id);\r\n  }\r\n};\r\n\r\nbuttonLoadPictures.addEventListener(\"click\", actionHandler);\r\ncontainer.addEventListener(\"click\", imageHandler);\r\npopupClose.addEventListener(\"click\", togglePopup);\r\n\r\ninitialState();\r\n"]}